services:
  # Web Service
  - type: web
    name: bot-hosting-platform
    env: node
    plan: free
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: SESSION_SECRET
        generateValue: true
      - key: DISCORD_CLIENT_ID
        sync: false
      - key: DISCORD_CLIENT_SECRET
        sync: false
      - key: DISCORD_CALLBACK_URL
        value: https://bot-hosting-platform.onrender.com/auth/discord/callback
      - key: DATABASE_URL
        fromDatabase:
          name: bot-hosting-db
          property: connectionString

  # Database
  - type: pserv
    name: bot-hosting-db
    env: postgres
    plan: free
    databases:
      - name: bot_hosting
        user: bot_hosting_user
        password: bot_hosting_password
    connectionOptions:
      ssl: true

  # Redis (for caching and sessions)
  - type: redis
    name: bot-hosting-redis
    plan: free
    ipAllowList: []

# Build and deployment settings
version: "1"

# Automatic deploys
autoDeploy: true

# Health checks
healthCheckPath: /health

# Scaling (if needed)
scaling:
  minInstances: 1
  maxInstances: 2
  targetCPUPercent: 70
  targetMemoryPercent: 80

# Custom domains (optional)
# domains:
#   - yourdomain.com
#   - www.yourdomain.com